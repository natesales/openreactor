# v3 plan

## Power Budget

| Device       | A   |
|--------------|-----|
| Backing pump | 1.6 |
| Turbo pump   | 4.6 |
| HV Supply    | XXX | 

## Battery Power
- Power bypass for 2x12V (24V) drill battery supplies
- DPDT switch to switch 24V supply from rectifier to DC
- Fused DC switch panel
- Panel mount anderson connectors for battery pack next to C13

Turbo (bottom): KF25 -> CF2.75
Gas system (back) (gauge and valve): 1/4" VCR -> CF2.75
HV feedthrough (top): CF2.75
L/R: CF2.75 blanks

Control Electronics:
- Peizo driver for valve (maybe DAC channel)
- Gauge RS232 adapter
- Turbo RS232 adapter
- HV DAC and voltage divider
Prototype all this on double breadboard

Front facing:
- USB serial to computer
- Digital control panel with display and big switches

- Switch for computer/automatic plasma
- Single switch for auto startup mode
- Button for energize plasma
- Lights/display for system state

Manual controls:
- Big estop button to cut 24v power
- Covered switch for controlled system startup:
  - Spin up pumps
  - Wait for vacuum stable
  - Ramp up voltage
  - Hold voltage at LE plasma
- If covered swich closed, auto control
- Wait for serial commands for each stage
- Prefixed by subsystem

## Computer Controlled Commands

If in computer control or manually activated, RSL (reactor signal light) is solid. If powered but unarmed, RSL blinking.

### FSM

#### Set Machine Idle (`N MIDLE`)
- HV off
- Vacuum off
- Electrolysis off

#### Set Machine Standby (`N MIDLE`)
- HV off
- Vacuum on
- Electrolysis PENDING

#### Set Machine Estop (`N MESTOP`)
- HV off
- Vac off
- Electrolysis off

### Vacuum

#### Read Vacuum Level (`N RVAC`)
Returns: vacuum level (overall from all gauges)

Links:
https://www.idealvac.com/en-nl/svpproduct.asp?PID=PT%20R15%20014%20A
https://www.idealspectroscopy.com/manuals.asp

## Power Delivery

AC (15A button breaker) -> Rectifier -> 24V -> main switch
DC (fuse) -> 24V -> main switch

main switch -> bus bar
                  -> 5V for control electronics
                  -> 24V for vac gauge
                  -> 24V for relay bank
                     -> 24V for backing pump
                     -> 24V for turbo pump
                     -> 24V for HV supply

#### MCU Pins

Analog (via voltage dividers):
- Vsupply
- Vion
- Iion

Digital:
- RS232 gauge
- RS232 pump
- I2C DAC -> hv setpoint/
- Mosfet RSL
- Covered switch for manual/auto control: on == 
- Interrupt to neutron counter
- Relay channel: backing pump
- Relay channel: turbo pump
- Relay channel: hv supply

Other I/O:
- Estop button to interrupt +24V supply

## Indicators
- RSL solid red:      running, HV/vac danger
- RSL blinking red:   ready to react
- RSL solid green:    idle, ready to accept command
- RSL blinking green: waiting

MCU requirements:
- 3 ADC channels (maybe by I2C ADC)
- 2 external serial
- 1 USB serial
- digital pins

Back panel:
- Mains AC
- Mains AC breaker
- Panel mount andersen +24V
- DC breaker
